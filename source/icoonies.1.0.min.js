/* Icoonies
 * version: 1.0 (04 Dec 2014)
 * Copyright (c) 2014 Alessandro Romanini ### Mattia Cattabiani 
 * icooniesteam@gmail.com
 
 * Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the "Software"), to deal in the Software without
   restriction, including without limitation the rights to use,
   copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following
   conditions:

   The above copyright notice and this permission notice shall be
   included in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   OTHER DEALINGS IN THE SOFTWARE.
 */
(function (e) { var t = e.fn.append; var n = e.fn.html; e.fn.append = function () { var n = t.apply(this, arguments); e(this).find(".icoonies").trigger("icooniesAppend"); return n }; e.fn.html = function () { var t = n.apply(this, arguments); e(this).find(".icoonies").trigger("icooniesAppend"); return t } })(jQuery); (function (e) { if (!e.browser && e.fn.jquery != "1.3.2") { e.extend({ browser: {} }); e.browser.init = function () { var t = {}; try { navigator.vendor ? /Chrome/.test(navigator.userAgent) ? (t.browser = "Chrome", t.version = parseFloat(navigator.userAgent.split("Chrome/")[1].split("Safari")[0])) : /Safari/.test(navigator.userAgent) ? (t.browser = "Safari", t.version = parseFloat(navigator.userAgent.split("Version/")[1].split("Safari")[0])) : /Opera/.test(navigator.userAgent) && (t.Opera = "Safari", t.version = parseFloat(navigator.userAgent.split("Version/")[1])) : /Firefox/.test(navigator.userAgent) ? (t.browser = "mozilla", t.version = parseFloat(navigator.userAgent.split("Firefox/")[1])) : (t.browser = "MSIE", /MSIE/.test(navigator.userAgent) ? t.version = parseFloat(navigator.userAgent.split("MSIE")[1]) : t.version = "edge") } catch (n) { t = n } if (!t.browser) { t.browser = "none"; t.version = 0 } e.browser[t.browser.toLowerCase()] = t.browser.toLowerCase(); e.browser.browser = t.browser; e.browser.version = t.version; e.browser.msie = e.browser.browser.toLowerCase() == "msie" }; e.browser.init() } })(jQuery); jQuery.extend({ isValidSelector: function (e) { try { var t = $(e) } catch (n) { return false } return true } }); if (typeof String.prototype.startsWith != "function") { String.prototype.startsWith = function (e) { return this.indexOf(e) == 0 } } var icoo = function (e, t, n, r) { var i = { options: { mode: "image", basepath: "" }, noimage_encoded: "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA2NzkgNjc5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA2NzkgNjc5IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMaXZlbGxvXzEiPg0KCTxwYXRoIGlkPSJpY29vLWFyZWEtMiIgc3R5bGU9ImZpbGw6I25vbmUgIWltcG9ydGFudDsgc3Ryb2tlOiM5QjAwN0UgIWltcG9ydGFudDsgc3Ryb2tlLXdpZHRoOjMxICFpbXBvcnRhbnQ7IGRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDsgb3BhY2l0eToxICFpbXBvcnRhbnQ7IiBmaWxsPSJub25lIiBzdHJva2U9IiM5QjAwN0UiIHN0cm9rZS13aWR0aD0iMzEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTQ4OC41MjUsNDAxLjc2Nw0KCQljLTQuMjM5LTcwLjkwNS0xMjEuNDMtMjE0LjMxMy0xODAuNDY5LTIwMC4zMDhjLTg3LjA0NSwyMC42NTItMTA2LjM1NCwxODguNTc4LTEwNi4zNTQsMTg4LjU3OHMtMjMuMTUxLTMuNDY2LTIxLjI2MiwzNi43NzUNCgkJYzAsMCwxLjMzMiw2OC43MjYsMTcuOTQ5LDg4LjI0YzUuOTAyLDYuOTI2LDExLjEwOSw2LjEyOSwxMS4xMDksNi4xMjljMjQuMzUyLDU2LjU1OSw3My40MjYsOTUuNDIyLDEzMy43MzQsOTUuNDIyDQoJCWM1Ny43MTksMCwxMDcuOTE5LTM1LjgxMywxMzMuNDY2LTg4LjUxM2MwLDAsOC4yMjksMS4yOTgsMTMuMjYxLTIuNDY0YzM1LjU3NC0yNi42NjMsNDEuMjYtNzguOTEyLDQxLjI2LTc4LjkxMg0KCQlDNTQxLjYxMSwzODQuNTI4LDQ4OC41MjUsNDAxLjc2Nyw0ODguNTI1LDQwMS43Njd6Ii8+DQoJPHBhdGggaWQ9Imljb28tYXJlYS0zIiBzdHlsZT0iZmlsbDojOUIwMDdFICFpbXBvcnRhbnQ7IGRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDsgb3BhY2l0eToxICFpbXBvcnRhbnQ7IiBmaWxsPSIjOUIwMDdFIiBkPSJNNDExLjg0NCwxMDAuNDE0Yy0xNS40OTYtNC42MjEtMjcuNDAyLTAuMjA1LTM4LjY3NiwwLjQ4M2MwLDAsMS44Ni0xNC40MTUtNi41MTEtMjkuMjQ2DQoJCWMtMTIuOTE5LTIyLjkzLTQyLjI0NS00Ny4zMzgtNzguMjQ2LTI0LjgwOGMwLDAtMC41OTgsNC4yNCw3Ljg3NiwyLjQxOWM4LjQ2OS0xLjgxLDY0LjMyNiwzMC4yNTQsMTUuMzIsNjIuNTIxDQoJCWMwLDAtNzQuMjE3LTMuNjMxLTc0LjgxNCw0Mi45NTFjLTAuNTk4LDQ2LjU4NywwLDAuODAyLDAsMC44MDJzLTAuMDQ2LDQyLjQyMiwzNS4wNTEsNjIuNTkxYzAsMCwzNy45NDItMjQuMDY3LDU0LjQ4Ni0yMy40NjUNCgkJYzAsMCwwLjUzNS02LjAyNiwyLjgyMy0xNS41MDJjLTEuOTU4LDEwLjA4NS0yLjgyMywxNy4wMTEtMi44MjMsMTcuMDExYzE3LjAzOS00Ljc3LDM5LjMwMyw3LjI0NCw0Ny44MzksMTEuMjUxDQoJCWMxMi44MjIsNjMuNzkxLTYuNzgzLTcuNzUxLDI3Ljk4My00Ny4zMjFjMjcuNjkyLTMxLjUxNyw0MS45NDIsMTMzLjkwNSw0MS45NDIsMTMzLjkwNQ0KCQlDNDY5LjkxNiwyNjAuMTI4LDQ4Ny42NjYsMTIzLjAwMiw0MTEuODQ0LDEwMC40MTR6Ii8+DQo8L2c+DQo8ZyBpZD0ibm8iPg0KCTxjaXJjbGUgaWQ9Imljb28tYXJlYS00IiBmaWxsPSJub25lIiBzdHlsZT0iZmlsbDpub25lICFpbXBvcnRhbnQ7IHN0cm9rZTojOUIwMDdFICFpbXBvcnRhbnQ7IHN0cm9rZS13aWR0aDoyOSAhaW1wb3J0YW50OyBkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7IG9wYWNpdHk6MSAhaW1wb3J0YW50OyIgc3Ryb2tlPSIjOUIwMDdFIiBzdHJva2Utd2lkdGg9IjI5IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSIzMzkuNSIgY3k9IjMzOS41IiByPSIzMjUiLz4NCgk8bGluZSBpZD0iaWNvby1hcmVhLTUiICBmaWxsPSJub25lIiBzdHlsZT0iZmlsbDpub25lICFpbXBvcnRhbnQ7IHN0cm9rZTojOUIwMDdFICFpbXBvcnRhbnQ7IHN0cm9rZS13aWR0aDoyOSAhaW1wb3J0YW50OyBkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7IG9wYWNpdHk6MSAhaW1wb3J0YW50OyIgc3Ryb2tlPSIjOUIwMDdFIiBzdHJva2Utd2lkdGg9IjI5IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI5OC4xNDgiIHkxPSIxMjUuNDkyIiB4Mj0iNTU0LjE1IiB5Mj0iNTgxLjQ5NCIvPg0KPC9nPg0KICA8c3R5bGU+DQogICAgKiAgIHsgDQoNCiAgICB9DQogICAgI2ljb28tYXJlYS0yICAgICAgeyBmaWxsOm5vbmUgIWltcG9ydGFudDsgc3Ryb2tlOiM5QjAwN0UgIWltcG9ydGFudDsgc3Ryb2tlLXdpZHRoOjMxICFpbXBvcnRhbnQ7IGRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDsgb3BhY2l0eToxICFpbXBvcnRhbnQ7ICAgICAtbXMtdHJhbnNmb3JtOm5vbmUgIWltcG9ydGFudDsgDQogICAgLXdlYmtpdC10cmFuc2Zvcm06IG5vbmUgIWltcG9ydGFudDsNCiAgICAtbW96LXRyYW5zZm9ybTogbm9uZSAhaW1wb3J0YW50OyANCiAgICAgdHJhbnNmb3JtOiBub25lICFpbXBvcnRhbnQ7DQogICAgIGFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IC1tb3otYW5pbWF0aW9uOm5vbmUgIWltcG9ydGFudDsgLXdlYmtpdC1hbmltYXRpb246bm9uZSAhaW1wb3J0YW50Ow0KICAgICBzdHJva2UtZGFzaGFycmF5Om5vbmUgIWltcG9ydGFudDsgc3Ryb2tlLWRhc2hvZmZzZXQ6aW5oZXJpdCAhaW1wb3J0YW50Ow0KICAgIH0NCiAgICAjaWNvby1hcmVhLTMgICAgICB7IGZpbGw6IzlCMDA3RSAhaW1wb3J0YW50OyBkaXNwbGF5OmJsb2NrICFpbXBvcnRhbnQ7IG9wYWNpdHk6MSAhaW1wb3J0YW50OyAgICAgLW1zLXRyYW5zZm9ybTpub25lICFpbXBvcnRhbnQ7IA0KICAgIC13ZWJraXQtdHJhbnNmb3JtOiBub25lICFpbXBvcnRhbnQ7DQogICAgLW1vei10cmFuc2Zvcm06IG5vbmUgIWltcG9ydGFudDsgDQogICAgIHRyYW5zZm9ybTogbm9uZSAhaW1wb3J0YW50Ow0KICAgICBhbmltYXRpb246bm9uZSAhaW1wb3J0YW50OyAtbW96LWFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IC13ZWJraXQtYW5pbWF0aW9uOm5vbmUgIWltcG9ydGFudDsgDQogICAgIHN0cm9rZS1kYXNoYXJyYXk6bm9uZSAhaW1wb3J0YW50OyBzdHJva2UtZGFzaG9mZnNldDppbmhlcml0ICFpbXBvcnRhbnQ7DQogICAgfQ0KICAgICNpY29vLWFyZWEtNCwNCiAgICAjaWNvby1hcmVhLTUgICAgICB7IGZpbGw6bm9uZSAhaW1wb3J0YW50OyBzdHJva2U6IzlCMDA3RSAhaW1wb3J0YW50OyBzdHJva2Utd2lkdGg6MjkgIWltcG9ydGFudDsgZGlzcGxheTpibG9jayAhaW1wb3J0YW50OyBvcGFjaXR5OjEgIWltcG9ydGFudDsgICAgIC1tcy10cmFuc2Zvcm06bm9uZSAhaW1wb3J0YW50OyANCiAgICAtd2Via2l0LXRyYW5zZm9ybTogbm9uZSAhaW1wb3J0YW50Ow0KICAgIC1tb3otdHJhbnNmb3JtOiBub25lICFpbXBvcnRhbnQ7IA0KICAgICB0cmFuc2Zvcm06IG5vbmUgIWltcG9ydGFudDsNCiAgICAgYW5pbWF0aW9uOm5vbmUgIWltcG9ydGFudDsgLW1vei1hbmltYXRpb246bm9uZSAhaW1wb3J0YW50OyAtd2Via2l0LWFuaW1hdGlvbjpub25lICFpbXBvcnRhbnQ7IA0KICAgICBzdHJva2UtZGFzaGFycmF5Om5vbmUgIWltcG9ydGFudDsgc3Ryb2tlLWRhc2hvZmZzZXQ6aW5oZXJpdCAhaW1wb3J0YW50Ow0KICAgIH0NCiAgICANCiAgICANCiAgPC9zdHlsZT4NCjwvc3ZnPg==", css_download: 0, css_length: 0, icooRules: [], icooBackgroundRules: [], icooSvgStyles: [], downloadconfiguration: 0, getRandomColor: function () { var e = "0123456789ABCDEF".split(""); var t = "#"; for (var n = 0; n < 6; n++) { t += e[Math.floor(Math.random() * 16)] } return t }, init: function (r) { if (t["icoo-ready"]) return; t["icoo-ready"] = true; i.icooCss = t["icooStyle"] || {}; i.downloadconfiguration = 0; i.options = n.extend({}, i.options, r); i.css_length = n(".icoonies-css").length; i.css_download = 0; i.cssregex = new RegExp("([^{}/]+){( |\\t){0,}/\\*icoonies([^\\*]{0,})\\*/(.[^}]+)}", "gmi"); i.css_region_regex = new RegExp("/\\*region([^\\*]{0,})\\*/(.*?)/\\*endregion\\*/", "gmi"); i.icoonies_regex = new RegExp("/\\*icoonies([^\\*]{0,})\\*/", "gmi"); i.cssregex_commment = new RegExp("/\\*[^\\*/]+\\*/", "gmi"); i.background_showarea = []; n("link[rel=stylesheet].icoonies-css").each(function () { var e = n(this).clone(); n.ajax({ url: e.attr("href").toString(), dataType: "text", cache: false, success: function (e) { i.parseRegionCss(e); i.parseCss(e, this.url) }, error: function (e) { console.dir(e); i.css_download += 1; i.icooCssParser(); i.icooParser() } }) }); n("style.icoonies-css").each(function () { i.parseRegionCss(n(this).html()); i.parseCss(n(this).html(), e.location.href) }); i.icooCssParser(); i.icooParser() }, parseCss: function (e, t) { var r = e.replace(/\\t{1,}|\\r|\\n/gmi, "").replace(/\r/gmi, " ").replace(/\n/gmi, " ").replace(/@media[^{]*\{(?:(?!\}\s*\}).)*/gmi, "").match(i.cssregex); if (r) { for (var s = 0; s < r.length; s++) { var o = r[s].replace(i.icoonies_regex, "$1").replace(i.cssregex_commment, "").split("{"); if (o.length > 0) { var u = o[0].replace(/\//g, "").split(","); var a = o[1].replace(/}/g, "").split(";"); var f = ""; var l = ""; for (var c = 0; c < u.length; c++) { l = u[c].trim(); if (!n.isValidSelector(l)) continue; var h = { selector: l, rules: [], css_url: t.toString() }; for (var p = 0; p < a.length; p++) { f = a[p].split(":"); if (f.length == 2) { var d = { key: f[0].trim().replace("icoo-", "").trim(), value: f[1].trim(), css: !f[0].trim().startsWith("icoo-"), background: f[0].trim().replace("icoo-", "").toLowerCase().startsWith("background") && f[1].trim().toLowerCase().startsWith("url"), embedstyle: f[0].trim() == "icoo-region", showarea: f[0].trim() == "icoo-showarea" }; h.rules.push(d) } } i.icooRules.push(h) } } } } i.css_download += 1; i.icooCssParser(); i.icooParser() }, parseRegionCss: function (e) { var t = e.replace(/\\t{1,}|\\r|\\n/gmi, "").replace(/\r/gmi, " ").replace(/\n/gmi, " ").match(i.css_region_regex); if (t) { for (var n = 0; n < t.length; n++) { var r = t[n].replace(i.css_region_regex, "$1").trim().toLowerCase(); var s = t[n].replace(i.css_region_regex, "$2").trim(); if (i.icooSvgStyles[r]) { i.icooSvgStyles[r] = i.icooSvgStyles[r] + " " + s } else { i.icooSvgStyles[r] = s } } } }, getSvgUrl: function (t, n) { var r = e.createElement("a"); r.href = t; var i = r.href.split("/"); r = null; delete r; i.pop(); if (n.startsWith("/") || n.toLowerCase().startsWith("http")) { return n } n = n.replace(/\.\.\//g, "|").split("|"); for (var s = 0; s < n.length; s++) { if (n[s] == "") { i.pop() } else { i.push(n[s]) } } return i.join("/") }, icooCssParser: function () { if (i.css_download < i.css_length) return; var e = new RegExp("url[ ]{0,}\\(['\\\"]{0,1}(.{1,}.svg)['\\\"]{0,1}\\)", "gmi"); i.icooBackgroundRules = []; for (var t = 0; t < i.icooRules.length; t++) { for (var r = 0; r < i.icooRules[t].rules.length; r++) { var s = i.icooRules[t].rules[r].value.match(e); if (i.icooRules[t].rules[r].background && s) { var o = { main: i.icooRules[t].selector, url: i.getSvgUrl(i.icooRules[t].css_url, s[0].replace(e, "$1")), rules: [{ selector: "svg", rules: [] }], showarea: false }; for (var u = 0; u < i.icooRules[t].rules.length; u++) { if (!i.icooRules[t].rules[u].css || i.icooRules[t].rules[u].embedstyle || i.icooRules[t].rules[u].showarea) { o.rules[0].rules.push(i.icooRules[t].rules[u]); if (i.icooRules[t].rules[u].showarea) { o.showarea = true } } } i.icooBackgroundRules.push(o) } } } for (var t = 0; t < i.icooBackgroundRules.length; t++) { for (var r = 0; r < i.icooRules.length; r++) { if (i.icooRules[r].selector.startsWith(i.icooBackgroundRules[t].main + " ") || i.icooRules[r].selector == ".IE") { i.icooBackgroundRules[t].rules.push({ selector: i.icooRules[r].selector.replace(i.icooBackgroundRules[t].main + " ", "").trim(), rules: i.icooRules[r].rules }) } } } for (var t = 0; t < i.icooBackgroundRules.length; t++) { var a = n('<div data-mode="image" data-src="' + i.icooBackgroundRules[t].url + '" class="icoonies"></div> '); i.renderIcoo(a, i.icooBackgroundRules[t].rules, i.icooBackgroundRules[t].main) } }, cssParser: function (e, t, n, r) { if (e) { var s = []; for (var o = 0; o < e.length; o++) { var u = e[o]; if (u.css && !u.background) { if (n.target.data("mode") && n.target.data("mode") == "image") { var a = t.attr("style"); if (!a) { a = "" } a += u.key + ":" + u.value + ";"; t.attr("style", a) } } else if (u.embedstyle) { var f = null; if (r && r.find("style").length == 0) { r.append("<style></style>"); f = r.find("style") } else if (r && r.find("style").length > 0) { f = r.find("style") } var l = u.value.split(","); for (var c = 0; c < l.length; c++) { var h = l[c].trim().toLowerCase(); if (i.icooSvgStyles[h]) { f.append(i.icooSvgStyles[h]) } } } else if (!u.background) { t.attr(u.key, u.value) } } } }, icooParser: function () { if (i.css_download < i.css_length) return; n(".icoonies").each(function () { n(this).removeClass("icoonies"); i.renderIcoo(n(this), i.icooRules) }); setTimeout(function () { for (var e = 0; e < i.icooBackgroundRules.length; e++) { if (i.icooBackgroundRules[e].showarea) { n(i.icooBackgroundRules[e].main).addClass("icoo-showarea").data("src", i.icooBackgroundRules[e].url) } if (n.browser.msie) { n(i.icooBackgroundRules[e].main).addClass("IE") } } }, 500); n(e).on("icooniesAppend", ".icoonies", function () { i.renderIcoo(n(this), i.icooRules) }); n(e).on("click", ".icoo-showarea", icoo.showPreview) }, renderIcoo: function (e, t, r, s) { e.removeClass("icoonies"); var o = e.data("class") || ""; var u = (e.attr("class") || " ").split(/\s+/); e.data("mode", e.data("mode") || i.options.mode); var a = e.data("position") || "xMinYMin"; var f = e; var l = { target: e, classList: e.attr("class").split(/\s+/), dataClassList: o, preserveAspectRatio: e.data("position") || "xMinYMin", showArea: e.data("showarea") || e.hasClass("icoo-showarea") || false, icooCss: i.icooCss, svg_outer: "" }; var c = e.data("src") || "icoonies-not-found"; if (c == "icoonies-not-found") return; n.ajax({ options: l, url: c, dataType: "text", async: false, success: function (e) { i.svgparser(e, this, t, r, s) }, error: function (e) { i.svgparser(Base64.decode(i.noimage_encoded), this, t, r, s) } }) }, svgparser: function (e, t, r, s, o) { t.options.svg_outer = ""; var u = n("<div></div>"); if (t.options.target.prop("tagName").toLowerCase() != "img") { u.append(n(t.options.target[0].outerHTML).append(e)) } else { u.append(e) } if (!u.find("svg")[0]) { t.options.target.remove(); return } var a = ""; if (t.options.showArea) { if (o) { t.options.target.data("mode", "svg") } else { t.options.target.addClass("icoo-showarea") } } if (n.browser.msie && t.options.target.data("mode") == "image") { a = "IE " } if (t.options.target.prop("tagName").toLowerCase() == "img") { u.find("svg").attr("class", t.options.classList.join(" ")); if (u.find("svg").attr("class")) { a += u.find("svg").attr("class") } } a += " " + t.options.dataClassList; u.find("svg").attr("class", a.trim()); var f = 1; u.find("svg").find("*").each(function () { if (n(this).prop("tagName").toLowerCase() == "defs" || n(this).prop("tagName").toLowerCase() == "g") { return } if (o) { n(this).attr("id", "icoo-previewarea-" + f++) } else { if (!n(this).attr("id")) { n(this).attr("id", "icoo-area-" + f++) } } if (o) { n(this).attr("onclick", "icoo.previewTitleClick(evt)"); n(this).attr("oldfill", i.getRandomColor()); n(this).attr("oldstroke", "#9B007E"); n(this).attr("oldstrokewidth", "2"); if (!n(this).attr("fill")) { n(this).attr("fill", "black") } if (!n(this).attr("stroke")) { n(this).attr("stroke", "black") } if (!n(this).attr("stroke-width")) { n(this).attr("stroke-width", "0") } n(this).append("<title>" + n(this).attr("id").replace("icoo-previewarea-", "icoo-area-") + "</title>") } }); for (var l = 0; l < r.length; l++) { try { var c = r[l]; u.find(c.selector).each(function () { var e = n(this); i.cssParser(c.rules, n(this), t.options, u.find("svg")) }) } catch (h) { } } u.find("svg").removeAttr("width").removeAttr("height"); u = u.find("svg"); if (u[0].outerHTML) { t.options.svg_outer = u[0].outerHTML } else { if (u[0].xml) { t.options.svg_outer = u[0].xml } else { t.options.svg_outer = n("<object></object>").append(u[0]).html() } } t.options.svg_outer = n(t.options.svg_outer); if (t.options.target.prop("tagName").toLowerCase() != "img") { t.options.svg_outer.addClass("zindex-area") } if (t.options.svg_outer[0].outerHTML) { t.options.svg_outer = t.options.svg_outer[0].outerHTML } else { if (t.options.svg_outer[0].xml) { t.options.svg_outer = t.options.svg_outer[0].xml } else { t.options.svg_outer = n("<object></object").append(u[0]).html() } } switch (t.options.target.data("mode")) { case "image": var p = "data:image/svg+xml;base64," + Base64.encode(i.webkitNamespaceBugWorkaround(t.options.svg_outer)); if (t.options.target.prop("tagName").toLowerCase() == "img") { t.options.target.attr("src", p) } else { if (s) { n("head").append("<style> " + s + " { background-image:url(" + p + ") !important; }    </style>") } else { var d = "icoonies_" + Math.ceil(Math.random() * 1e7); n("head").append('<style id="' + d + '"> .' + d + " { background-image:url(" + p + "); background-repeat:no-repeat; }   @media screen\0 { ." + d + " { background-size:100%;  } }</style>"); t.options.target.addClass(d) } } break; default: if (t.options.target.prop("tagName").toLowerCase() == "img") { var v = n('<object class="obj"></object>'); if (!o) { if (t.options.showArea) { v.addClass("icoo-showarea"); v.attr("data-src", t.options.target.data("src")) } } v.append(n(t.options.svg_outer)); v.insertBefore(t.options.target); t.options.target.remove() } else { if (!t.options.target.hasClass("icoonies-relative")) { t.options.target.addClass("icoonies-relative") } t.options.svg_outer = n(t.options.svg_outer).clone(); t.options.svg_outer.attr("class", ("icoonies-bg" + (t.options.showArea ? " zindex-area" : "") + " " + this.options.dataClassList).trim()); if (t.options.svg_outer[0].outerHTML) { t.options.svg_outer = t.options.svg_outer[0].outerHTML } else { if (t.options.svg_outer[0].xml) { t.options.svg_outer = t.options.svg_outer[0].xml } else { t.options.svg_outer = (new XMLSerializer).serializeToString(t.options.svg_outer[0]) } } t.options.target.append(i.webkitNamespaceBugWorkaround(t.options.svg_outer)) } } }, previewTitleClick: function (e) { var t = n(e.target); var r = t.attr("oldstroke").toString(); var i = t.attr("oldstrokewidth").toString(); var s = t.attr("oldfill").toString(); t.attr("oldfill", t.attr("fill").toString()); t.attr("fill", s); t.attr("oldstroke", t.attr("stroke").toString()); t.attr("stroke", r); t.attr("oldstrokewidth", t.attr("stroke-width").toString()); t.attr("stroke-width", i) }, showPreview: function (e) { if (n("#icoo-img-modal").length == 0) { n("body").append(n('<div class="icoo-modal-opacity" style="display:none;"><div class="icoo-modal"><a class="icoo-close-modal" href="">close</a><div class="icoo-overflow-modal"><p>Point your mouse over the image to see the different areas. Click over the area to see the form.</p><div class="icoo-aree-modal" id="icoo-img-modal"></div></div></div></div>')); n(".icoo-close-modal").on("click", function () { n(".icoo-modal-opacity").hide(); return false }) } e.preventDefault(); n("#icoo-img-modal").empty().append('<img id="icoo-preview-img" class="icoo-preview" data-src="' + n(this).data("src") + '"  data-mode="svg" " data-showarea="true" />'); i.renderIcoo(n("#icoo-preview-img"), i.icooRules, "", true); n(".icoo-modal-opacity").show() }, webkitNamespaceBugWorkaround: function (e) { var t = e.replace(/\ xlink=/g, " xmlns:xlink=", "g"); t = t.replace(/\ href=/g, " xlink:href=", "g"); return t } }; return i }(document, window, jQuery)